<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contador de ESP32</title>
<style>
body { font-family: Arial; background:#f0f2f5; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;}
h1{color:#0066cc;}
#contador,#flujo,#nivel1,#nivel2,#nivel3{font-size:1.5rem; margin:10px;}
button{padding:10px 20px; background:#0066cc;color:white;border:none;border-radius:8px;cursor:pointer;}
button:hover{background:#004d99;}
</style>
</head>
<body>
<h1>Contador de ESP32</h1>
<p>Conductividad: <span id="contador">0</span> ÂµS/cm</p>
<p>Flujo actual: <span id="flujo">0</span> L</p>
<p>Nivel TK100: <span id="nivel1">0</span></p>
<p>Nivel TK101: <span id="nivel2">0</span></p>
<p>Nivel TK900: <span id="nivel3">0</span></p>

<button onclick="enviarAgua()">Enviar Agua</button>
<button onclick="window.location.href='/monitor'">Monitor</button>
<button onclick="window.location.href='/historial'">Historial</button>
<button onclick="window.location.href='/registro'">Registro Osmosis</button>

<script>
async function actualizar(){
  const res = await fetch('/data');
  const datos = await res.json();
  if(datos.length>0){
    const ultimo = datos[datos.length-1];
    document.getElementById('contador').innerText = ultimo.ec.toFixed(2);
    document.getElementById('flujo').innerText = (ultimo.flujo||0).toFixed(2);
    document.getElementById('nivel1').innerText = ultimo.nivel1;
    document.getElementById('nivel2').innerText = ultimo.nivel2;
    document.getElementById('nivel3').innerText = ultimo.nivel3;
  }
}

async function enviarAgua(){
  const litros = prompt("Cantidad de agua a enviar (L):");
  if(litros){
    await fetch('/enviar',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({litros:parseFloat(litros)})
    });
  }
}

setInterval(actualizar,3000);
</script>
</body>
</html>
