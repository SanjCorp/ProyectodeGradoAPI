<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Agua</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Control de Ósmosis</h1>

<section>
  <h2>Estado del Motor y Flujómetro</h2>
  <p>Motor: <span id="motorStatus">OFF</span></p>
  <p>Litros enviados: <span id="litrosSent">0</span></p>
</section>

<section>
  <h2>Enviar Agua</h2>
  <button onclick="sendOrder(5000)">Preparar (5000L)</button>
  <button onclick="sendOrder(2000)">Aforar (2000L)</button>
  <button onclick="sendOrder(450)">CIP (450L)</button>
  <input type="number" id="customLiters" placeholder="Otro L" />
  <button onclick="sendOrderCustom()">Enviar Otro</button>
</section>

<script>
async function sendOrder(liters) {
  const response = await fetch("/place_order", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({litros: liters})
  });
  alert(await response.json().then(d=>d.message));
}

async function sendOrderCustom() {
  const liters = parseFloat(document.getElementById("customLiters").value);
  if(liters>0) sendOrder(liters);
}

async function updateStatus() {
  const res = await fetch("/enviar");
  const data = await res.json();
  document.getElementById("motorStatus").innerText = data.litros>0 ? "ON" : "OFF";
  document.getElementById("litrosSent").innerText = data.litros;
  setTimeout(updateStatus, 1000); // refrescar cada 1s
}

updateStatus();
</script>
</body>
</html>
